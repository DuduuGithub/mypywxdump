# 微信数据导出测试

本目录包含了微信数据导出和图片解密的测试代码及相关文件。

## 目录结构

- `decrypted/`: 存放解密后的数据库文件
  - `de_MSG.db`: 解密后的聊天记录数据库
  - `de_MicroMsg.db`: 解密后的联系人数据库
  - 其他相关数据库文件

- `exports/`: 导出的数据文件目录
  - `chat_messages_[timestamp].json`: 聊天记录的JSON格式导出
  - `chat_messages_[timestamp].csv`: 聊天记录的CSV格式导出
  - `contacts_[timestamp].json`: 联系人信息的JSON格式导出
  - `contacts_[timestamp].csv`: 联系人信息的CSV格式导出
  - `decrypt_images_log_[timestamp].txt`: 图片解密过程的详细日志
  - `decrypted_images/`: 解密后的图片文件，保持原始目录结构
    - `MsgAttach/`: 微信原始图片目录结构
      - `[用户ID]/Image/[年份-月份]/`: 按用户和时间组织的图片

## 数据字段说明

### 聊天记录字段
- `id`: 消息的本地ID
- `CreateTime`: 消息发送时间，格式为 "YYYY-MM-DD HH:MM:SS"
- `room_name`: 聊天室名称（群聊时显示群名）
- `talker`: 发送者的ID
- `msg`: 消息内容
- `type_name`: 消息类型（如：文本、图片、语音等）
- `is_sender`: 是否为自己发送（1为自己发送，0为接收）
- `MsgSvrID`: 消息服务器ID
- `extra`: 额外信息
- `src`: 原始文件路径（针对图片、语音等媒体文件）
- `decrypted_image`: 解密后的图片绝对路径（仅针对图片消息）

### 联系人信息字段
- `wxid`: 用户ID
- `wx_account`: 微信号
- `remark`: 备注名
- `nickname`: 昵称
- `type`: 联系人类型（普通好友/其他来源）
- `labels`: 标签列表

## 图片解密说明

### 解密过程
1. 程序会自动检测聊天记录中的图片消息
2. 对于每个图片消息：
   - 首先查找原始的.dat文件
   - 使用XOR算法进行解密
   - 保存为正常的图片格式（jpg/png等）
   - 在导出数据中记录解密后的图片路径

### 特别说明
- 微信采用按需加载的方式处理图片，只有当图片被查看过后才会下载到本地
- 如果图片文件不存在，通常是因为该图片从未被打开过
- 要获取这些图片，需要在微信中手动打开它们，之后再次运行本程序
- 群聊图片说明：
  - 自己发送的图片会保存在本地
  - 他人发送的图片需要打开查看后才会保存

### 统计信息
程序会在 `decrypt_images_log_[timestamp].txt` 中记录详细的解密过程，包括：
- 总共处理的图片数量
- 成功解密的图片数量
- 每张图片的具体处理结果
- 解密失败或文件缺失的原因

## 使用方法

1. 确保以管理员权限运行
2. 运行 `test.py` 进行数据导出和图片解密
3. 查看 `exports` 目录获取导出的数据
4. 通过日志文件了解详细的处理过程

## 注意事项

1. 需要管理员权限才能读取微信进程内存
2. 确保微信正在运行且已登录
3. 图片解密依赖于本地缓存，未查看过的图片可能无法解密
4. 建议定期备份导出的数据 